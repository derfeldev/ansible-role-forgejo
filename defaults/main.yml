---
# SPDX-FileCopyrightText: 2025 Pavel Dimov <@sagat79>
#
# SPDX-License-Identifier: CC0-1.0

forgejo_enabled: true

# Project source code URL: https://forgejo.org
# renovate: datasource=docker depName=codeberg.org/forgejo/forgejo
forgejo_version: 12.0.3

forgejo_identifier: forgejo

forgejo_scheme: https

# The fully-qualified name of your Forgejo server (e.g. `forgejo.example.com`)
forgejo_hostname: ''

forgejo_path_prefix: /

forgejo_uid: ''
forgejo_gid: ''

forgejo_container_image: "{{ forgejo_container_image_registry_prefix }}forgejo/forgejo:{{ forgejo_container_image_tag }}"
forgejo_container_image_tag: "{{ forgejo_version }}-rootless"
forgejo_container_image_force_pull: "{{ forgejo_container_image.endswith(':latest') }}"
forgejo_container_image_registry_prefix: codeberg.org/

# Container image self-build options
forgejo_container_image_self_build: false
forgejo_container_image_self_build_name: "forgejo/forgejo:{{ forgejo_container_image_self_build_repo_version }}"
forgejo_container_image_self_build_repo: "https://codeberg.org/forgejo/forgejo.git"
forgejo_container_image_self_build_repo_version: "v{{ forgejo_version }}"
forgejo_container_image_self_build_dockerfile: "Dockerfile.rootless"
forgejo_container_image_self_build_src_files_path: "{{ forgejo_base_path }}/docker-src"

forgejo_base_path: "/{{ forgejo_identifier }}"
forgejo_data_dir_path: "{{ forgejo_base_path }}/data"
forgejo_config_dir_path: "{{ forgejo_base_path }}/config"

forgejo_ssh_port: 22

forgejo_http_bind_port: ''
forgejo_ssh_bind_port: "{{ forgejo_ssh_port }}"

forgejo_systemd_required_systemd_services_list: ['docker.service']
forgejo_systemd_wanted_systemd_services_list: []

# Container stop grace time in seconds
forgejo_container_stop_grace_time_seconds: 30

forgejo_config_database_type: postgres
forgejo_config_database_hostname: ''
forgejo_config_database_port: "{{ 5432 if forgejo_config_database_type == 'postgres' else (3306 if forgejo_config_database_type == 'mysql' else '') }}"
forgejo_config_database_name: forgejo
forgejo_config_database_username: ''
forgejo_config_database_password: ''

# Database SSL configuration
forgejo_config_database_ssl_mode: ''
forgejo_config_database_ssl_ca: ''
forgejo_config_database_ssl_cert: ''
forgejo_config_database_ssl_key: ''

forgejo_config_root_url: "{{ forgejo_scheme }}://{{ forgejo_hostname }}{{ forgejo_path_prefix }}"

# Controls the RUN_USER configuration setting (`FORGEJO____RUN_USER` environment variable).
#
# This defaults to `git` in the upstream configuration.
#
# On startup, Forgejo checks if the resolved username for the user it works with matches the RUN_USER.
#
# Because we run the container with a custom user (forgejo_uid),
# and not with uid=1000 matching the git user and inside the container,
# unless we unset this, we'd get an error message:
# > `Expect user 'git' but current user is: `
# The relevant check is here: https://codeberg.org/forgejo/forgejo/src/commit/adb8c085c5269e9fd3c7b80a8c4989dfd4ccb1da/modules/setting/setting.go#L279-L282
#
# Unsetting this to an empty string makes it match. Unless you forgejo_uid accidentally hits some other user that is part of the container's /etc/passwd file.
forgejo_config_run_user: "{{ 'git' if forgejo_uid | string == '1000' else '' }}"

# When integrating Forgejo with Woodpecker CI, and if Woodpecker is
# served under a subpath (e.g. `https://forgejo.host/ci`), it is
# necessary to use Docker's `--add-host` option to point Forgejo to
# the external host IP, so that webhook calls to Woodpecker can work.
#
# For example:
#
#  forgejo_container_add_host_domain_name: "{{ devture_woodpecker_ci_server_hostname }}"
#  forgejo_container_add_host_domain_ip_address: "{{ ansible_host }}"
#
# Don't forget to also update `webhook.ALLOWED_HOST_LIST` on Forgejo's
# app.ini config file.
forgejo_container_add_host_domain_name: ''
forgejo_container_add_host_domain_ip_address: ''

# forgejo_container_labels_traefik_enabled controls whether labels to assist a Traefik reverse-proxy will be attached to the container.
# See `templates/labels.j2` for details.
#
# To inject your own other container labels, see `forgejo_container_labels_additional_labels`.
forgejo_container_labels_traefik_enabled: true
forgejo_container_labels_traefik_docker_network: ''
forgejo_container_labels_traefik_hostname: "{{ forgejo_hostname }}"
# The path prefix must either be `/` or not end with a slash (e.g. `/forgejo`).
forgejo_container_labels_traefik_path_prefix: "{{ forgejo_path_prefix }}"
forgejo_container_labels_traefik_rule: "Host(`{{ forgejo_container_labels_traefik_hostname }}`){% if forgejo_container_labels_traefik_path_prefix != '/' %} && PathPrefix(`{{ forgejo_container_labels_traefik_path_prefix | quote }}`){% endif %}"
forgejo_container_labels_traefik_priority: 0
forgejo_container_labels_traefik_entrypoints: web-secure
forgejo_container_labels_traefik_tls: "{{ forgejo_container_labels_traefik_entrypoints != 'web' }}"
forgejo_container_labels_traefik_tls_certResolver: default  # noqa var-naming

# Controls which additional headers to attach to all HTTP requests.
# To add your own custom request headers, use `forgejo_container_labels_traefik_additional_response_headers_custom`
forgejo_container_labels_traefik_additional_request_headers: "{{ forgejo_container_labels_traefik_additional_request_headers_auto | combine(forgejo_container_labels_traefik_additional_request_headers_custom) }}"
forgejo_container_labels_traefik_additional_request_headers_auto: |
  {{
    {}
    | combine ({'X-Script-Name': forgejo_path_prefix} if forgejo_path_prefix != '/' else {})
  }}
forgejo_container_labels_traefik_additional_request_headers_custom: {}

# Controls which additional headers to attach to all HTTP responses.
# To add your own custom response headers, use `forgejo_container_labels_traefik_additional_response_headers_custom`
forgejo_container_labels_traefik_additional_response_headers: "{{ forgejo_container_labels_traefik_additional_response_headers_auto | combine(forgejo_container_labels_traefik_additional_response_headers_custom) }}"
forgejo_container_labels_traefik_additional_response_headers_auto: |
  {{
    {}
    | combine ({'X-XSS-Protection': forgejo_http_header_xss_protection} if forgejo_http_header_xss_protection else {})
    | combine ({'X-Frame-Options': forgejo_http_header_frame_options} if forgejo_http_header_frame_options else {})
    | combine ({'X-Content-Type-Options': forgejo_http_header_content_type_options} if forgejo_http_header_content_type_options else {})
    | combine ({'Content-Security-Policy': forgejo_http_header_content_security_policy} if forgejo_http_header_content_security_policy else {})
    | combine ({'Permission-Policy': forgejo_http_header_content_permission_policy} if forgejo_http_header_content_permission_policy else {})
    | combine ({'Strict-Transport-Security': forgejo_http_header_strict_transport_security} if forgejo_http_header_strict_transport_security and forgejo_container_labels_traefik_tls else {})
  }}
forgejo_container_labels_traefik_additional_response_headers_custom: {}

# forgejo_container_labels_additional_labels contains a multiline string with additional labels to add to the container label file.
# See `templates/labels.j2` for details.
#
# Example:
# forgejo_container_labels_additional_labels: |
#   my.label=1
#   another.label="here"
forgejo_container_labels_additional_labels: ''

# forgejo_container_additional_environment_variables contains a multiline string with additional environment variables to pass to the container.
#
# Example:
# forgejo_container_additional_environment_variables: |
#   VAR=1
#   ANOTHER=value
forgejo_container_additional_environment_variables: ''

forgejo_container_network: "{{ forgejo_identifier }}"

# A list of additional container networks that the container would be connected to.
# The playbook does not create these networks, so make sure they already exist.
forgejo_container_additional_networks: "{{ forgejo_container_additional_networks_auto + forgejo_container_additional_networks_custom }}"
forgejo_container_additional_networks_auto: []
# Use this to expose this container to a reverse proxy, which runs in a different container network.
forgejo_container_additional_networks_custom: []

# A list of additional "volumes" to mount in the container.
# This list gets populated dynamically at runtime. You can provide a different default value,
# if you wish to mount your own files into the container.
# Contains definition objects like this: `{"type": "bind", "src": "/outside", "dst": "/inside", "options": "readonly"}`.
# See the `--mount` documentation for the `docker run` command.
forgejo_container_additional_volumes: "{{ forgejo_container_additional_volumes_auto + forgejo_container_additional_volumes_custom }}"
forgejo_container_additional_volumes_auto: []
forgejo_container_additional_volumes_custom: []

# Additional environment variables.
forgejo_environment_variables_additional_variables: ''

# Security settings
forgejo_config_security_install_lock: false
forgejo_config_security_secret_key: ''
forgejo_config_security_internal_token: ''
forgejo_config_security_login_remember_days: 7
forgejo_config_security_cookie_secure: false
forgejo_config_security_cookie_httponly: true
forgejo_config_security_cookie_samesite: lax
forgejo_config_security_disable_gravatar: false
forgejo_config_security_enable_captcha: false
forgejo_config_security_captcha_type: image
forgejo_config_security_captcha_recaptcha_secret: ''
forgejo_config_security_captcha_recaptcha_site_key: ''

# Mail settings
forgejo_config_mail_enabled: false
forgejo_config_mail_host: ''
forgejo_config_mail_port: 587
forgejo_config_mail_username: ''
forgejo_config_mail_password: ''
forgejo_config_mail_from: ''
forgejo_config_mail_use_tls: true
forgejo_config_mail_use_ssl: false

# Logging configuration
forgejo_config_log_level: Info
forgejo_config_log_mode: console
forgejo_config_log_file_path: ''

# Backup settings
forgejo_backup_enabled: false
forgejo_backup_path: '/data/forgejo/backup'
forgejo_backup_retention_days: 7
forgejo_backup_include_attachments: true
forgejo_backup_include_git_hooks: true
forgejo_backup_include_lfs: true

# Performance and caching settings
forgejo_config_cache_adapter: memory
forgejo_config_cache_ttl: 3600
forgejo_config_cache_interval: 1800
forgejo_config_cache_conn: ''
forgejo_config_cache_item_ttl: 0
forgejo_config_cache_prefix: 'forgejo_cache_'

# Session settings
forgejo_config_session_provider: memory
forgejo_config_session_provider_config: ''
forgejo_config_session_cookie_name: 'forgejo_session'

# Repository settings
forgejo_config_repository_upload_max_size: 3
forgejo_config_repository_upload_allowed_types: ''
forgejo_config_repository_upload_max_files: 5
forgejo_config_repository_enable_timetracking: true
forgejo_config_repository_enable_issues: true
forgejo_config_repository_enable_pulls: true
forgejo_config_repository_enable_wiki: true
forgejo_config_repository_enable_external_tracker: false
forgejo_config_repository_enable_external_wiki: false

# Issue and pull request settings
forgejo_config_issue_enable_dependencies: true
forgejo_config_issue_enable_time_tracking: true
forgejo_config_issue_enable_telemetry: false
forgejo_config_issue_enable_assignee: true
forgejo_config_issue_enable_labels: true

# Search and indexing
forgejo_config_search_enabled: true
forgejo_config_search_indexer_type: bleve
forgejo_config_search_max_indexer_workers: 4
forgejo_config_search_indexer_repo_batch_size: 16

# Attachment settings
forgejo_config_attachment_enabled: true
forgejo_config_attachment_path: '/data/forgejo/attachments'
forgejo_config_attachment_max_size: 4
forgejo_config_attachment_allowed_types: 'image/*,application/pdf,text/*'
forgejo_config_attachment_max_files: 5

# Git LFS settings
forgejo_config_lfs_enabled: true
forgejo_config_lfs_path: '/data/forgejo/lfs'
forgejo_config_lfs_max_file_size: 100
forgejo_config_lfs_storage_type: local

# Federation settings
forgejo_config_federation_enabled: true
forgejo_config_federation_shared: false
forgejo_config_federation_private: false
forgejo_config_federation_limited: false

# Mirror repository settings
forgejo_config_mirror_enabled: true
forgejo_config_mirror_interval: 8
forgejo_config_mirror_timeout: 300
forgejo_config_mirror_skip_tls_verify: false

# Admin and system management settings
forgejo_config_admin_username: admin
forgejo_config_admin_email: admin@example.com
forgejo_config_admin_password: ''
forgejo_config_admin_confirm_password: ''

# System notice settings
forgejo_config_system_notice_enabled: false
forgejo_config_system_notice_message: ''
forgejo_config_system_notice_type: info

# Time and locale settings
forgejo_config_time_format: '2006-01-02 15:04:05'
forgejo_config_date_format: '2006-01-02'
forgejo_config_default_ui_location: 'auto'
forgejo_config_default_theme: gitea

# Gravatar and Captcha settings
forgejo_config_gravatar_enabled: true
forgejo_config_gravatar_source: gravatar
forgejo_config_gravatar_url: 'https://www.gravatar.com/avatar/'

# Captcha settings
forgejo_config_captcha_enabled: false
forgejo_config_captcha_type: image
forgejo_config_captcha_recaptcha_secret: ''
forgejo_config_captcha_recaptcha_site_key: ''
forgejo_config_captcha_recaptcha_url: 'https://www.google.com/recaptcha/'

# Metrics and monitoring settings
forgejo_config_metrics_enabled: false
forgejo_config_metrics_token: ''
forgejo_config_metrics_interval: 60
forgejo_config_metrics_timeout: 30

# Backup and maintenance settings
forgejo_config_backup_auto_backup_enabled: false
forgejo_config_backup_auto_backup_retention_days: 7
forgejo_config_backup_auto_backup_time: '02:00'
forgejo_config_backup_auto_backup_include_attachments: true
forgejo_config_backup_auto_backup_include_git_hooks: true
forgejo_config_backup_auto_backup_include_lfs: true

# Maintenance mode settings
forgejo_config_maintenance_mode_enabled: false
forgejo_config_maintenance_mode_message: 'Site is under maintenance. Please check back later.'
forgejo_config_maintenance_mode_allow_webhooks: false
forgejo_config_maintenance_mode_allow_api: false

# Notification and webhook settings
forgejo_config_notification_webhook_timeout: 5
forgejo_config_notification_webhook_retry_after: 60
forgejo_config_notification_webhook_max_deliveries: 3
forgejo_config_notification_webhook_skip_tls_verify: false

# Security and access control settings
forgejo_config_security_enable_login_status: true
forgejo_config_security_enable_login_source: true
forgejo_config_security_enable_remember_me: true
forgejo_config_security_enable_2fa: true
forgejo_config_security_enable_oauth: true
forgejo_config_security_enable_ldap: false
forgejo_config_security_enable_saml: false

# User registration and access
forgejo_config_user_enable_registration: true
forgejo_config_user_enable_captcha: false
forgejo_config_user_enable_email_confirmation: false
forgejo_config_user_enable_require_signin_view: false

# Repository and issue management settings
forgejo_config_repository_enable_actions: true
forgejo_config_repository_enable_packages: true
forgejo_config_repository_enable_projects: true
forgejo_config_repository_enable_releases: true

# API and webhook settings
forgejo_config_api_enable_swagger: true
forgejo_config_api_max_response_items: 50
forgejo_config_api_default_paging_num: 30
forgejo_config_api_max_paging_num: 100

# Webhook delivery settings
forgejo_config_webhook_deliver_timeout: 5
forgejo_config_webhook_deliver_retry_after: 60
forgejo_config_webhook_max_deliveries: 3
forgejo_config_webhook_skip_tls_verify: false

# SSH and Git settings
forgejo_config_ssh_minimum_key_size: 2048
forgejo_config_ssh_authorized_keys_backup: true
forgejo_config_ssh_authorized_keys_backup_dir: '/data/ssh/authorized_keys_backup'
forgejo_config_git_max_git_diff_lines: 1000
forgejo_config_git_max_git_diff_line_character_limit: 5000
forgejo_config_git_max_git_diff_files: 100

# Notification and cron job settings
forgejo_config_notification_enable_email: true
forgejo_config_notification_enable_webhook: true
forgejo_config_notification_enable_slack: false
forgejo_config_notification_slack_webhook_url: ''
forgejo_config_notification_slack_channel: ''

# Cron job settings
forgejo_config_cron_update_mirrors: '0 * * * *'
forgejo_config_cron_repo_health_check: '0 0 * * *'
forgejo_config_cron_check_repo_stats: '0 0 * * 0'
forgejo_config_cron_clean_old_archives: '0 0 1 * *'

# Health check and monitoring settings
forgejo_config_health_check_enabled: true
forgejo_config_health_check_timeout: 30
forgejo_config_health_check_interval: 60
forgejo_config_health_check_retries: 3

# LDAP integration settings
forgejo_config_ldap_enabled: false
forgejo_config_ldap_host: ''
forgejo_config_ldap_port: 389
forgejo_config_ldap_bind_dn: ''
forgejo_config_ldap_bind_password: ''
forgejo_config_ldap_search_base: ''
forgejo_config_ldap_search_filter: ''
forgejo_config_ldap_user_filter: ''
forgejo_config_ldap_admin_filter: ''

# OAuth integration settings
forgejo_config_oauth_enabled: false
forgejo_config_oauth_provider: ''
forgejo_config_oauth_client_id: ''
forgejo_config_oauth_client_secret: ''
forgejo_config_oauth_redirect_uri: ''
forgejo_config_oauth_scopes: ''

# SAML integration settings
forgejo_config_saml_enabled: false
forgejo_config_saml_idp_metadata_url: ''
forgejo_config_saml_idp_entity_id: ''
forgejo_config_saml_sp_entity_id: ''
forgejo_config_saml_certificate: ''
forgejo_config_saml_private_key: ''

# Rate limiting and API settings
forgejo_config_rate_limit_enabled: true
forgejo_config_rate_limit_requests_per_minute: 60
forgejo_config_rate_limit_burst: 100
forgejo_config_rate_limit_window: 60
